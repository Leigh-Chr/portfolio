---
import BaseLayout from '@layouts/BaseLayout.astro';
---

<BaseLayout
  title="Contact"
  description="Contactez-moi pour discuter de vos projets ou simplement échanger."
>
  <!-- Hero Section -->
  <section class="section-padding section-hero relative overflow-hidden">
    <div class="container-custom text-center" data-gsap="hero">
      <h1 class="page-title">
        <span class="gradient-text-animated underline-zigzag" data-text="Contactez">Contactez</span
        >-moi
      </h1>
      <div class="section-divider section-divider-long"></div>
      <p class="page-subtitle">
        Une question, un projet, ou juste envie de discuter ? Écrivez-moi, je réponds vite.
      </p>
    </div>
  </section>

  <!-- Contact Section (2 pts) -->
  <section class="section-padding section-alt section-lazy">
    <div class="container-custom">
      <div class="max-w-5xl mx-auto" data-gsap="reveal">
        <div class="grid lg:grid-cols-2 gap-8 md:gap-12 lg:gap-16">
          <!-- Contact Info -->
          <div>
            <h2 class="section-title text-left mb-8">
              Mes <span class="text-primary-400 underline-memphis">coordonnées</span>
            </h2>

            <div class="space-y-8">
              <!-- Email -->
              <a
                href="mailto:virgil.07@hotmail.fr"
                class="card-glow p-6 flex items-start gap-6 group"
              >
                <div class="icon-box">
                  <svg
                    class="w-6 h-6 text-primary-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                    ></path>
                  </svg>
                </div>
                <div>
                  <h3 class="font-heading font-bold text-xl text-white mb-1">Email</h3>
                  <p class="text-gray-300 group-hover:text-primary-400 transition-colors">
                    virgil.07@hotmail.fr
                  </p>
                  <p class="text-gray-400 text-sm mt-1">Je réponds généralement sous 24-48h</p>
                </div>
              </a>

              <!-- LinkedIn -->
              <a
                href="https://linkedin.com/in/virgil-chareyre"
                target="_blank"
                rel="noopener noreferrer"
                class="card-glow p-6 flex items-start gap-6 group"
              >
                <div class="icon-box">
                  <svg
                    class="w-6 h-6 text-primary-400"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path
                      d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"
                    ></path>
                  </svg>
                </div>
                <div>
                  <h3 class="font-heading font-bold text-xl text-white mb-1">LinkedIn</h3>
                  <p class="text-gray-300 group-hover:text-primary-400 transition-colors">
                    linkedin.com/in/virgil-chareyre
                  </p>
                  <p class="text-gray-400 text-sm mt-1">Connectons-nous professionnellement</p>
                </div>
              </a>

              <!-- GitHub -->
              <a
                href="https://github.com/Leigh-Chr"
                target="_blank"
                rel="noopener noreferrer"
                class="card-glow p-6 flex items-start gap-6 group"
              >
                <div class="icon-box">
                  <svg
                    class="w-6 h-6 text-white"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path
                      d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
                    ></path>
                  </svg>
                </div>
                <div>
                  <h3 class="font-heading font-bold text-xl text-white mb-1">GitHub</h3>
                  <p class="text-gray-300 group-hover:text-primary-400 transition-colors">
                    github.com/Leigh-Chr
                  </p>
                  <p class="text-gray-400 text-sm mt-1">Mes projets open source</p>
                </div>
              </a>

              <!-- Location -->
              <div class="card-glow p-6 flex items-start gap-6">
                <div class="icon-box">
                  <svg
                    class="w-6 h-6 text-accent-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                    ></path>
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                </div>
                <div>
                  <h3 class="font-heading font-bold text-xl text-white mb-1">Localisation</h3>
                  <p class="text-gray-400">Grenoble, France</p>
                  <p class="text-gray-400 text-sm mt-1">
                    Disponible en remote ou sur site — mobilité possible
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Contact Form -->
          <div>
            <h2 class="section-title text-left mb-8">
              Envoyez-moi un <span
                class="text-accent-400 underline-memphis underline-memphis-accent">message</span
              >
            </h2>

            <form
              class="card-glow p-4 sm:p-6 md:p-8"
              action="https://api.web3forms.com/submit"
              method="POST"
              id="contact-form"
              novalidate
            >
              <input type="hidden" name="access_key" value="789d2e26-aedf-4f2c-809f-616fc1174acf" />
              <input type="checkbox" name="botcheck" class="hidden" style="display: none;" />
              <div class="space-y-8">
                <!-- Name -->
                <div>
                  <label for="name" class="block text-sm font-medium text-gray-300 mb-2">
                    Votre nom <span class="text-primary-400">*</span>
                  </label>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    required
                    aria-required="true"
                    aria-describedby="name-error"
                    autocomplete="name"
                    minlength="2"
                    maxlength="100"
                    class="form-input"
                    placeholder="Jean Dupont"
                  />
                  <p
                    id="name-error"
                    class="text-red-400 text-xs mt-1 hidden"
                    role="alert"
                    aria-live="assertive"
                  >
                  </p>
                </div>

                <!-- Email -->
                <div>
                  <label for="email" class="block text-sm font-medium text-gray-300 mb-2">
                    Votre email <span class="text-primary-400">*</span>
                  </label>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    aria-required="true"
                    aria-describedby="email-error"
                    autocomplete="email"
                    class="form-input"
                    placeholder="jean.dupont@example.com"
                  />
                  <p
                    id="email-error"
                    class="text-red-400 text-xs mt-1 hidden"
                    role="alert"
                    aria-live="assertive"
                  >
                  </p>
                </div>

                <!-- Subject -->
                <div>
                  <label for="subject" class="block text-sm font-medium text-gray-300 mb-2">
                    Sujet
                  </label>
                  <select
                    id="subject"
                    name="subject"
                    aria-describedby="subject-hint"
                    class="form-select"
                  >
                    <option value="" disabled selected>Sélectionnez un sujet</option>
                    <option value="project">Proposition de projet</option>
                    <option value="job">Opportunité professionnelle</option>
                    <option value="collaboration">Collaboration</option>
                    <option value="question">Question</option>
                    <option value="other">Autre</option>
                  </select>
                  <p id="subject-hint" class="text-gray-500 text-xs mt-1">
                    Optionnel - aide à prioriser les messages
                  </p>
                </div>

                <!-- Message -->
                <div>
                  <label for="message" class="block text-sm font-medium text-gray-300 mb-2">
                    Votre message <span class="text-primary-400">*</span>
                  </label>
                  <textarea
                    id="message"
                    name="message"
                    rows="5"
                    required
                    aria-required="true"
                    aria-describedby="message-error message-hint"
                    minlength="10"
                    maxlength="2000"
                    class="form-textarea"
                    placeholder="Bonjour, je souhaiterais discuter de..."></textarea>
                  <p id="message-hint" class="text-gray-500 text-xs mt-1">Minimum 10 caractères</p>
                  <p
                    id="message-error"
                    class="text-red-400 text-xs mt-1 hidden"
                    role="alert"
                    aria-live="assertive"
                  >
                  </p>
                </div>

                <!-- Submit -->
                <button
                  type="submit"
                  id="submit-btn"
                  class="w-full btn-chunky-primary justify-center"
                >
                  <span id="submit-text">Envoyer le message</span>
                  <span id="submit-loading" class="hidden">Envoi en cours...</span>
                  <svg
                    class="w-6 h-6 ml-2"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                  </svg>
                </button>
              </div>

              <!-- Note about form -->
              <p class="text-gray-400 text-xs mt-4 text-center" id="privacy-notice">
                Vos données sont traitées de manière sécurisée et ne seront jamais partagées.
              </p>
            </form>

            <script>
              // Client-side form validation
              const form = document.getElementById('contact-form') as HTMLFormElement;
              const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
              const submitText = document.getElementById('submit-text');
              const submitLoading = document.getElementById('submit-loading');

              const validators = {
                name: (value: string) => {
                  if (!value.trim()) return 'Le nom est requis';
                  if (value.length < 2) return 'Le nom doit contenir au moins 2 caractères';
                  return '';
                },
                email: (value: string) => {
                  if (!value.trim()) return "L'email est requis";
                  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                  if (!emailRegex.test(value)) return 'Veuillez entrer un email valide';
                  return '';
                },
                message: (value: string) => {
                  if (!value.trim()) return 'Le message est requis';
                  if (value.length < 10) return 'Le message doit contenir au moins 10 caractères';
                  return '';
                },
              };

              function showError(fieldId: string, message: string) {
                const errorEl = document.getElementById(`${fieldId}-error`);
                const inputEl = document.getElementById(fieldId);
                if (errorEl && inputEl) {
                  errorEl.textContent = message;
                  errorEl.classList.remove('hidden');
                  inputEl.classList.add('border-red-400');
                  inputEl.setAttribute('aria-invalid', 'true');
                }
              }

              function clearError(fieldId: string) {
                const errorEl = document.getElementById(`${fieldId}-error`);
                const inputEl = document.getElementById(fieldId);
                if (errorEl && inputEl) {
                  errorEl.textContent = '';
                  errorEl.classList.add('hidden');
                  inputEl.classList.remove('border-red-400');
                  inputEl.removeAttribute('aria-invalid');
                }
              }

              // Validate on blur
              ['name', 'email', 'message'].forEach((fieldId) => {
                const input = document.getElementById(fieldId);
                input?.addEventListener('blur', () => {
                  const value = (input as HTMLInputElement | HTMLTextAreaElement).value;
                  const error = validators[fieldId as keyof typeof validators]?.(value);
                  if (error) {
                    showError(fieldId, error);
                  } else {
                    clearError(fieldId);
                  }
                });

                // Clear error on input
                input?.addEventListener('input', () => clearError(fieldId));
              });

              // Form submission
              form?.addEventListener('submit', async (e) => {
                e.preventDefault();
                let hasErrors = false;

                // Validate all fields
                ['name', 'email', 'message'].forEach((fieldId) => {
                  const input = document.getElementById(fieldId) as
                    | HTMLInputElement
                    | HTMLTextAreaElement;
                  const error = validators[fieldId as keyof typeof validators]?.(
                    input?.value || ''
                  );
                  if (error) {
                    showError(fieldId, error);
                    hasErrors = true;
                  }
                });

                if (hasErrors) {
                  // Focus first error field
                  const firstError = form.querySelector('[aria-invalid="true"]') as HTMLElement;
                  firstError?.focus();
                  return;
                }

                // Show loading state
                submitBtn.disabled = true;
                submitText?.classList.add('hidden');
                submitLoading?.classList.remove('hidden');

                try {
                  const response = await fetch(form.action, {
                    method: 'POST',
                    body: new FormData(form),
                    headers: { Accept: 'application/json' },
                  });

                  if (response.ok) {
                    form.innerHTML = `
                      <div class="text-center py-8">
                        <div class="text-4xl mb-4">✅</div>
                        <h3 class="text-xl font-heading font-bold text-white mb-2">Message envoyé !</h3>
                        <p class="text-gray-400">Merci pour votre message. Je vous répondrai dans les plus brefs délais.</p>
                      </div>
                    `;
                  } else {
                    throw new Error("Erreur lors de l'envoi");
                  }
                } catch {
                  submitBtn.disabled = false;
                  submitText?.classList.remove('hidden');
                  submitLoading?.classList.add('hidden');
                  alert('Une erreur est survenue. Veuillez réessayer ou me contacter par email.');
                }
              });
            </script>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Availability Section -->
  <section class="section-padding relative overflow-hidden">
    <div class="container-custom">
      <div class="max-w-3xl mx-auto text-center" data-gsap="reveal">
        <h2 class="section-title mb-6">
          <span class="text-primary-400 underline-memphis">Disponibilité</span>
        </h2>
        <div class="section-divider mb-10"></div>
        <div class="flex items-center justify-center gap-4 mb-6">
          <span class="w-3 h-3 bg-accent-400"></span>
          <span class="text-white font-heading font-medium">Actuellement disponible</span>
        </div>
        <p class="text-gray-400">
          Actuellement en Mastère Expert en Ingénierie Logicielle, je suis développeur Fullstack
          avec une appétence particulière pour le front-end. Je recherche des opportunités en CDI ou
          CDD, idéalement à Grenoble ou en remote — mais je reste ouvert à la mobilité pour le bon
          projet.
        </p>

        <!-- Response time -->
        <div
          class="mt-8 sm:mt-10 pt-8 sm:pt-10 border-t border-dark-600 flex flex-wrap justify-center gap-6 sm:gap-10 md:gap-16"
        >
          <div class="text-center group min-w-[80px]">
            <p class="stat-medium text-primary-400">24-48h</p>
            <p
              class="text-xs sm:text-sm text-gray-400 font-heading font-medium uppercase tracking-wide mt-2"
            >
              Temps de réponse
            </p>
          </div>
          <div class="text-center group min-w-[80px]">
            <p class="stat-medium text-accent-400">Remote</p>
            <p
              class="text-xs sm:text-sm text-gray-400 font-heading font-medium uppercase tracking-wide mt-2"
            >
              Mode de travail
            </p>
          </div>
          <div class="text-center group min-w-[80px]">
            <p class="stat-medium text-white">France</p>
            <p
              class="text-xs sm:text-sm text-gray-400 font-heading font-medium uppercase tracking-wide mt-2"
            >
              Fuseau horaire
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
