---
import BaseLayout from '@layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { url } from '@utils/url';

// Get all projects from content collection
const allProjects = await getCollection('projects');
const sortedProjects = allProjects.sort((a, b) => a.data.order - b.data.order);

const hasRealContent = sortedProjects.length > 0;

// Placeholder projects if none exist
const placeholderProjects = [
  {
    slug: 'project-1',
    data: {
      title: 'Application Web E-commerce',
      shortDescription:
        "D√©veloppement d'une plateforme e-commerce compl√®te avec panier, paiement et gestion des stocks.",
      thumbnail: null,
      context: { period: '2024', role: 'Lead Developer', company: 'Entreprise X' },
    },
  },
  {
    slug: 'project-2',
    data: {
      title: 'API REST Microservices',
      shortDescription:
        'Architecture microservices pour une application bancaire avec haute disponibilit√©.',
      thumbnail: null,
      context: { period: '2023', role: 'Backend Developer', company: 'Entreprise Y' },
    },
  },
  {
    slug: 'project-3',
    data: {
      title: 'Dashboard Analytics',
      shortDescription:
        "Interface de visualisation de donn√©es en temps r√©el pour le monitoring d'infrastructure.",
      thumbnail: null,
      context: { period: '2023', role: 'Full Stack Developer', company: 'Entreprise Z' },
    },
  },
  {
    slug: 'project-4',
    data: {
      title: 'Application Mobile Cross-Platform',
      shortDescription:
        'Application mobile React Native pour la gestion de t√¢ches et la productivit√©.',
      thumbnail: null,
      context: { period: '2022', role: 'Mobile Developer', company: 'Startup A' },
    },
  },
  {
    slug: 'project-5',
    data: {
      title: 'Syst√®me de Gestion de Contenu',
      shortDescription: 'CMS sur mesure avec √©diteur WYSIWYG et syst√®me de permissions avanc√©.',
      thumbnail: null,
      context: { period: '2022', role: 'Full Stack Developer', company: 'Agence B' },
    },
  },
];

const displayProjects = hasRealContent ? sortedProjects : placeholderProjects;
---

<BaseLayout
  title="R√©alisations"
  description="Mes projets en entreprise et perso, du frontend au backend."
>
  <!-- Hero Section -->
  <section class="section-padding section-hero relative overflow-hidden">
    <div class="container-custom text-center" data-gsap="hero">
      <h1 class="page-title">
        Mes <span
          class="gradient-text-animated underline-zigzag underline-zigzag-accent"
          data-text="R√©alisations">R√©alisations</span
        >
      </h1>
      <div class="section-divider section-divider-accent section-divider-long"></div>
      <p class="page-subtitle">
        Ce que j'ai construit, en entreprise et sur mon temps libre. Chaque projet raconte un bout
        de mon parcours.
      </p>

      <!-- Stats - Bold Memphis with subtle tilts -->
      <div class="flex flex-wrap justify-center gap-4 sm:gap-8 md:gap-16 mt-12 sm:mt-16">
        <div
          class="text-center p-4 sm:p-6 bg-dark-800 border-3 border-dark-600 group hover:border-primary-500 transition-all shadow-hard-lg hover:shadow-hard-xl min-w-[120px]"
        >
          <p class="stat-large text-primary-400">{hasRealContent ? sortedProjects.length : 3}</p>
          <p
            class="text-xs sm:text-sm text-gray-400 font-heading font-medium uppercase tracking-wide mt-2"
          >
            R√©alisations
          </p>
        </div>
        <div
          class="text-center p-4 sm:p-6 bg-dark-800 border-3 border-dark-600 group hover:border-accent-400 transition-all shadow-hard-lg hover:shadow-hard-xl min-w-[120px]"
        >
          <p class="stat-large text-accent-400">+3</p>
          <p
            class="text-xs sm:text-sm text-gray-400 font-heading font-medium uppercase tracking-wide mt-2"
          >
            Ann√©es d'exp.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Projects Grid (5 pts) -->
  <section class="section-padding section-alt">
    <div class="container-custom">
      {
        !hasRealContent && (
          <div class="alert-placeholder mb-8">
            <strong>[PLACEHOLDER]</strong> Les projets ci-dessous sont des exemples. Remplacez-les
            par vos vraies r√©alisations dans les fichiers de contenu.
          </div>
        )
      }

      <!-- Projects as list/cards with short descriptions -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 md:gap-8" data-gsap="stagger">
        {
          displayProjects.map((project, index) => (
            <a
              href={url(`/projects/${project.id}`)}
              class={`card-glow overflow-hidden group ${!hasRealContent ? 'opacity-70' : ''}`}
            >
              {/* Thumbnail */}
              <div
                class="aspect-video bg-dark-700 relative overflow-hidden"
                transition:name={`project-thumb-${project.id}`}
              >
                {project.data.fullImage ? (
                  <div class="w-full h-full scroll-preview">
                    <img
                      src={url(project.data.fullImage)}
                      alt={`Aper√ßu du projet ${project.data.title}`}
                      class="scroll-preview-img"
                      loading="lazy"
                      decoding="async"
                    />
                  </div>
                ) : project.data.thumbnail ? (
                  <img
                    src={url(project.data.thumbnail)}
                    alt={`Aper√ßu du projet ${project.data.title}`}
                    class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                    loading="lazy"
                    decoding="async"
                    width="384"
                    height="216"
                  />
                ) : (
                  <div class="w-full h-full flex items-center justify-center">
                    <div class="text-center">
                      <span class="text-6xl opacity-30">üìÅ</span>
                      <p class="text-gray-400 text-sm mt-2">[Image projet]</p>
                    </div>
                  </div>
                )}
                {/* Project number badge */}
                <div class="absolute top-4 left-4 w-8 h-8 bg-primary-500 flex items-center justify-center z-10">
                  <span class="text-white font-heading font-bold text-sm">{index + 1}</span>
                </div>
              </div>

              {/* Content */}
              <div class="p-4 sm:p-6 md:p-8">
                {/* Context tags */}
                <div class="flex flex-wrap gap-3 mb-4">
                  <span class="tag-primary text-xs">{project.data.context.period}</span>
                  <span class="tag-gray text-xs">{project.data.context.role}</span>
                </div>

                {/* Title */}
                <h2
                  class="font-heading font-bold text-xl md:text-2xl text-white mb-3 group-hover:text-primary-400 transition-colors"
                  transition:name={`project-title-${project.id}`}
                >
                  {!hasRealContent && '[PLACEHOLDER] '}
                  {project.data.title}
                </h2>

                {/* Short description */}
                <p class="text-gray-400 text-sm line-clamp-3 mb-6 leading-relaxed">
                  {project.data.shortDescription}
                </p>

                {/* CTA */}
                <div class="flex items-center text-primary-400 text-sm font-heading font-medium">
                  <span>Voir le projet</span>
                  <svg
                    class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"
                    />
                  </svg>
                </div>
              </div>
            </a>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Link to Skills -->
  <section class="section-padding">
    <div class="container-custom text-center">
      <h2 class="section-title">
        Les comp√©tences derri√®re ces <span
          class="text-accent-400 underline-memphis underline-memphis-accent">r√©alisations</span
        >
      </h2>
      <div class="section-divider section-divider-accent"></div>
      <p class="section-subtitle mb-12">
        Derri√®re chaque projet, il y a des comp√©tences concr√®tes. Voici le d√©tail.
      </p>
      <a href={url('/skills')} class="btn-chunky-primary">
        Voir mes comp√©tences
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
        </svg>
      </a>
    </div>
  </section>

  <!-- CTA Contact -->
  <section class="section-padding section-cta relative overflow-hidden">
    <div class="container-custom text-center" data-gsap="cta">
      <h2 class="section-title text-white mb-8">
        Un projet en <span class="text-accent-400 squiggle squiggle-accent">t√™te</span> ?
      </h2>
      <p class="text-gray-300 text-xl mb-12 max-w-2xl mx-auto leading-relaxed">
        Vous avez un projet ? Parlons-en.
      </p>
      <a
        href={url('/contact')}
        class="btn-chunky bg-white text-dark-900 border-dark-900 hover:bg-gray-100"
      >
        Me contacter
      </a>
    </div>
  </section>
</BaseLayout>
