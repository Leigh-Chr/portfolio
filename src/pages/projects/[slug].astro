---
import { slide } from 'astro:transitions';
import BaseLayout from '@layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({
    params: { slug: project.id },
    props: { project },
  }));
}

const { project } = Astro.props;

// Project links from schema
const links = project.data.links;

// Parse markdown content into sections
const rawContent = project.body;

function extractSection(content: string, sectionName: string): string {
  const regex = new RegExp(`## ${sectionName}[\\s\\S]*?(?=## |$)`, 'i');
  const match = content.match(regex);
  if (!match) return '';
  return match[0].replace(new RegExp(`## ${sectionName}[^\\n]*\\n?`, 'i'), '').trim();
}

function parseKeyValueSection(content: string): Record<string, string> {
  const result: Record<string, string> = {};
  const lines = content.split('\n');
  let currentKey = '';
  let currentValue = '';

  for (const line of lines) {
    const match = line.match(/^\*\*([^*]+)\*\*\s*:\s*(.*)$/);
    if (match) {
      if (currentKey) {
        result[currentKey] = currentValue.trim();
      }
      currentKey = match[1].trim();
      currentValue = match[2];
    } else if (currentKey && line.trim()) {
      currentValue += ' ' + line.trim();
    }
  }
  if (currentKey) {
    result[currentKey] = currentValue.trim();
  }
  return result;
}

function parsePhases(content: string): Array<{title: string, description: string}> {
  const phases: Array<{title: string, description: string}> = [];
  const regex = /\*\*([^*]+)\*\*\s*:\s*([^*]+?)(?=\*\*|$)/g;
  let match;
  while ((match = regex.exec(content)) !== null) {
    phases.push({
      title: match[1].trim(),
      description: match[2].trim()
    });
  }
  return phases;
}

function parseList(content: string): string[] {
  const items: string[] = [];
  const lines = content.split('\n');
  for (const line of lines) {
    const match = line.match(/^[-*]\s+(.+)$/);
    if (match) {
      items.push(match[1].trim());
    }
  }
  return items;
}

function parseActeursList(content: string): Array<{role: string, description: string}> {
  const acteurs: Array<{role: string, description: string}> = [];
  const lines = content.split('\n');
  for (const line of lines) {
    // Format: - **Role** : Description
    const match = line.match(/^[-*]\s+\*\*([^*]+)\*\*\s*:\s*(.+)$/);
    if (match) {
      acteurs.push({
        role: match[1].trim(),
        description: match[2].trim()
      });
    }
  }
  return acteurs;
}

function parseSubsections(content: string): Record<string, string> {
  const result: Record<string, string> = {};
  const regex = /### ([^\n]+)\n([\s\S]*?)(?=### |$)/g;
  let match;
  while ((match = regex.exec(content)) !== null) {
    result[match[1].trim()] = match[2].trim();
  }
  return result;
}

function parseResultats(content: string): {pourMoi: string[], pourEntreprise: string[], unified: string[]} {
  const subsections = parseSubsections(content);
  const result = {
    pourMoi: [] as string[],
    pourEntreprise: [] as string[],
    unified: [] as string[]
  };

  if (subsections['Pour moi']) {
    result.pourMoi = parseList(subsections['Pour moi']);
  }
  if (subsections['Pour l\'entreprise']) {
    result.pourEntreprise = parseList(subsections['Pour l\'entreprise']);
  }

  // If no subsections, parse as unified list
  if (result.pourMoi.length === 0 && result.pourEntreprise.length === 0) {
    result.unified = parseList(content);
  }

  return result;
}

function parseCritique(content: string): {intro: string, positif: string[], amelioration: string[]} {
  const result = { intro: '', positif: [] as string[], amelioration: [] as string[] };

  const positifMatch = content.match(/\*\*Ce qui a bien fonctionn√©\*\*\s*:\s*([^*]+?)(?=\*\*|$)/);
  if (positifMatch) {
    result.positif = [positifMatch[1].trim()];
  }

  const diffMatch = content.match(/\*\*Ce que j'aurais fait diff√©remment\*\*\s*:\s*([^*]+?)(?=\*\*|$)/);
  if (diffMatch) {
    result.amelioration = [diffMatch[1].trim()];
  }

  const leconMatch = content.match(/\*\*Le√ßon apprise\*\*\s*:\s*([^*]+?)(?=\*\*|$)/);
  if (leconMatch) {
    result.amelioration.push(leconMatch[1].trim());
  }

  return result;
}

// Extract sections
const presentationContent = extractSection(rawContent, 'Pr√©sentation');
const objectifsContent = extractSection(rawContent, 'Objectifs, contexte, enjeu et risques');
const etapesContent = extractSection(rawContent, '√âtapes ‚Äì ce que j\'ai fait');
const acteursContent = extractSection(rawContent, 'Acteurs ‚Äì les interactions') || extractSection(rawContent, 'Comp√©tences mobilis√©es');
const resultatsContent = extractSection(rawContent, 'R√©sultats');
const lendemainsContent = extractSection(rawContent, 'Lendemains du projet');
const critiqueContent = extractSection(rawContent, 'Regard critique');

// Parse structured data
const objectifs = parseKeyValueSection(objectifsContent);
const phases = parsePhases(etapesContent);
const acteursList = parseActeursList(acteursContent);
const resultats = parseResultats(resultatsContent);
const lendemains = parseSubsections(lendemainsContent);
const critique = parseCritique(critiqueContent);

// Get related skills
const allSkills = await getCollection('skills');
const relatedSkills = allSkills.filter(s =>
  project.data.relatedSkills.includes(s.id)
);

// Get all projects for navigation
const allProjects = await getCollection('projects');
const sortedProjects = allProjects.sort((a, b) => a.data.order - b.data.order);
const currentIndex = sortedProjects.findIndex(p => p.id === project.id);
const prevProject = currentIndex > 0 ? sortedProjects[currentIndex - 1] : null;
const nextProject = currentIndex < sortedProjects.length - 1 ? sortedProjects[currentIndex + 1] : null;

// Check if it's a personal project
const isPersonalProject = project.data.context.company === 'Projet Personnel';
const hasActeursList = acteursList.length > 0;
const hasSubsectionResultats = resultats.pourMoi.length > 0 || resultats.pourEntreprise.length > 0;
---

<BaseLayout
  title={project.data.title}
  description={project.data.shortDescription}
>
  <!-- BreadcrumbList Schema -->
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Accueil",
          "item": "https://leigh-chr.github.io/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "R√©alisations",
          "item": "https://leigh-chr.github.io/projects/"
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": project.data.title,
          "item": `https://leigh-chr.github.io/projects/${project.id}/`
        }
      ]
    })} />
  </Fragment>

  <!-- Hero Section -->
  <section class="section-padding section-hero noise-overlay">
    <div class="container-custom">
      <div class="max-w-4xl mx-auto fade-in-up">
        <!-- Breadcrumb -->
        <nav class="flex items-center gap-2 text-sm text-gray-400 mb-6" aria-label="Fil d'Ariane">
          <a href="/" class="hover:text-primary-400 transition-colors">Accueil</a>
          <span>/</span>
          <a href="/projects" class="hover:text-primary-400 transition-colors">R√©alisations</a>
          <span>/</span>
          <span class="text-white">{project.data.title}</span>
        </nav>

        <!-- Header -->
        <div class="flex flex-col md:flex-row gap-8 items-start">
          <!-- Thumbnail with scroll animation on hover -->
          <div
            class="w-full md:w-1/3 aspect-video overflow-hidden bg-dark-700 shadow-hard-lg border-2 border-primary-500 flex-shrink-0 group/thumb"
            transition:name={`project-thumb-${project.id}`}
          >
            {project.data.fullImage ? (
              <div class="relative w-full h-full overflow-hidden scroll-preview">
                <img
                  src={project.data.fullImage}
                  alt={`Aper√ßu du projet ${project.data.title}`}
                  class="scroll-preview-img"
                  loading="lazy"
                  decoding="async"
                />
              </div>
            ) : project.data.thumbnail ? (
              <img
                src={project.data.thumbnail}
                alt={`Aper√ßu du projet ${project.data.title}`}
                class="w-full h-full object-cover"
                width="400"
                height="225"
                loading="lazy"
                decoding="async"
              />
            ) : (
              <div class="w-full h-full flex items-center justify-center">
                <span class="text-6xl opacity-30">üìÅ</span>
              </div>
            )}
          </div>

          <!-- Info -->
          <div class="flex-grow">
            <div class="flex flex-wrap gap-3 mb-6">
              <span class="tag-primary">
                {project.data.context.period}
              </span>
              <span class="tag-accent">
                {project.data.context.role}
              </span>
              {project.data.context.company && (
                <span class="tag-gray">
                  {project.data.context.company}
                </span>
              )}
            </div>

            <h1
              class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-heading font-black text-white mb-4 tracking-tight"
              transition:name={`project-title-${project.id}`}
            >
              <span class="underline-memphis underline-memphis-accent">{project.data.title}</span>
            </h1>

            <p class="text-base sm:text-lg md:text-xl text-gray-400">
              {project.data.shortDescription}
            </p>

            {/* Project Links */}
            {links && (links.repository || links.website) && (
              <div class="flex flex-wrap gap-3 mt-6">
                {links.repository && (
                  <a
                    href={links.repository}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="inline-flex items-center gap-2 px-4 py-2 bg-dark-700 border-2 border-dark-600 hover:border-primary-500 text-gray-300 hover:text-white transition-all duration-200"
                    aria-label={`Voir le code source de ${project.data.title} sur GitHub`}
                  >
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                      <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-sm font-medium">Code source</span>
                  </a>
                )}
                {links.website && (
                  <a
                    href={links.website}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="inline-flex items-center gap-2 px-4 py-2 bg-primary-500/10 border-2 border-primary-500 text-primary-400 hover:bg-primary-500 hover:text-white transition-all duration-200"
                    aria-label={`Visiter le site de ${project.data.title}`}
                  >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                    </svg>
                    <span class="text-sm font-medium">Voir le site</span>
                  </a>
                )}
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Content Sections -->
  <div class="container-custom section-padding" transition:animate={slide({ duration: '0.3s' })}>
    <div class="max-w-4xl mx-auto">

      <!-- Section 1: Pr√©sentation du projet -->
      {presentationContent && (
        <section class="mb-20" id="presentation">
          <div class="content-section-header">
            <div class="icon-box-sm">
              <span class="text-xl">üìã</span>
            </div>
            <h2 class="content-section-title">Pr√©sentation du <span class="text-primary-400 underline-memphis">Projet</span></h2>
          </div>
          <div class="section-divider ml-0 mx-0 mb-8"></div>
          <div class="prose prose-lg prose-invert max-w-none text-gray-400 detail-box">
            <div set:html={presentationContent
              .split('\n\n')
              .map(p => `<p>${p.replace(/\*\*([^*]+)\*\*/g, '<strong class="text-white">$1</strong>')}</p>`)
              .join('')
            } />
          </div>
        </section>
      )}

      <!-- Section 2: Objectifs, Contexte, Enjeux, Risques -->
      {Object.keys(objectifs).length > 0 && (
        <section class="mb-20" id="contexte">
          <div class="content-section-header">
            <div class="icon-box-sm">
              <span class="text-xl">üéØ</span>
            </div>
            <h2 class="content-section-title">Objectifs, Contexte et <span class="text-accent-400 underline-memphis underline-memphis-accent">Enjeux</span></h2>
          </div>
          <div class="section-divider section-divider-accent ml-0 mx-0 mb-8"></div>
          <div class="grid md:grid-cols-2 gap-4 sm:gap-6 md:gap-8">
            {objectifs['Contexte'] && (
              <div class="detail-box">
                <h3 class="font-heading font-bold text-xl text-white mb-3 flex items-center gap-2">
                  <span class="text-accent-400">üìç</span> Contexte
                </h3>
                <p class="text-gray-400 text-sm">{objectifs['Contexte']}</p>
              </div>
            )}

            {objectifs['Probl√©matique'] && (
              <div class="detail-box">
                <h3 class="font-heading font-bold text-xl text-white mb-3 flex items-center gap-2">
                  <span class="text-primary-400">‚ùì</span> Probl√©matique
                </h3>
                <p class="text-gray-400 text-sm">{objectifs['Probl√©matique']}</p>
              </div>
            )}

            {objectifs['Objectifs'] && (
              <div class="detail-box">
                <h3 class="font-heading font-bold text-xl text-white mb-3 flex items-center gap-2">
                  <span class="text-primary-400">üéØ</span> Objectifs
                </h3>
                <p class="text-gray-400 text-sm">{objectifs['Objectifs']}</p>
              </div>
            )}

            {(objectifs['Enjeux'] || objectifs['Risques identifi√©s']) && (
              <div class="detail-box">
                <h3 class="font-heading font-bold text-xl text-white mb-3 flex items-center gap-2">
                  <span class="text-accent-400">‚ö†Ô∏è</span> {objectifs['Enjeux'] ? 'Enjeux' : 'Risques'}
                </h3>
                <p class="text-gray-400 text-sm">{objectifs['Enjeux'] || objectifs['Risques identifi√©s']}</p>
              </div>
            )}
          </div>
        </section>
      )}

      <!-- Section 3: Les √âtapes -->
      {phases.length > 0 && (
        <section class="mb-20" id="etapes">
          <div class="content-section-header">
            <div class="icon-box-sm">
              <span class="text-xl">üìù</span>
            </div>
            <h2 class="content-section-title">Les <span class="text-primary-400 underline-memphis">√âtapes</span> - Ce que j'ai fait</h2>
          </div>
          <div class="section-divider ml-0 mx-0 mb-8"></div>
          <div class="detail-box">
            <div class="space-y-8">
              {phases.map((phase, index) => (
                <div class="flex gap-4">
                  <div class="flex flex-col items-center">
                    <div class={`w-10 h-10 ${index === phases.length - 1 ? 'bg-accent-400' : 'bg-primary-500'} flex items-center justify-center`}>
                      <span class={`font-heading font-bold ${index === phases.length - 1 ? 'text-dark-900' : 'text-white'}`}>{index + 1}</span>
                    </div>
                    {index < phases.length - 1 && <div class="w-0.5 h-full bg-dark-600 mt-2"></div>}
                  </div>
                  <div class={index < phases.length - 1 ? 'pb-6' : ''}>
                    <h3 class="font-heading font-bold text-white mb-2">{phase.title}</h3>
                    <p class="text-gray-400 text-sm">{phase.description}</p>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </section>
      )}

      <!-- Section 4: Acteurs / Comp√©tences mobilis√©es -->
      {(hasActeursList || acteursContent) && (
        <section class="mb-20" id="acteurs">
          <div class="content-section-header">
            <div class="icon-box-sm">
              <span class="text-xl">{isPersonalProject ? 'üõ†Ô∏è' : 'üë•'}</span>
            </div>
            <h2 class="content-section-title">
              {isPersonalProject ? (
                <span>Comp√©tences <span class="text-accent-400 underline-memphis underline-memphis-accent">Mobilis√©es</span></span>
              ) : (
                <span>Les <span class="text-accent-400 underline-memphis underline-memphis-accent">Acteurs</span> - Les Interactions</span>
              )}
            </h2>
          </div>
          <div class="section-divider section-divider-accent ml-0 mx-0 mb-8"></div>

          {hasActeursList ? (
            <div class="detail-box">
              <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 md:gap-8">
                {acteursList.map((acteur, index) => (
                  <div class="p-6 bg-dark-700 border border-dark-600 text-center">
                    <div class={`w-12 h-12 bg-dark-600 border-2 ${index % 2 === 0 ? 'border-primary-500' : 'border-accent-400'} flex items-center justify-center mx-auto mb-2`}>
                      <span class="text-xl">üë§</span>
                    </div>
                    <h3 class="font-heading font-medium text-white text-sm">{acteur.role}</h3>
                    <p class="text-gray-400 text-xs mt-1">{acteur.description}</p>
                  </div>
                ))}
              </div>
            </div>
          ) : (
            <div class="detail-box">
              <p class="text-gray-400">{acteursContent}</p>
            </div>
          )}
        </section>
      )}

      <!-- Section 5: Les R√©sultats -->
      {(hasSubsectionResultats || resultats.unified.length > 0) && (
        <section class="mb-20" id="resultats">
          <div class="content-section-header">
            <div class="icon-box-sm">
              <span class="text-xl">üèÜ</span>
            </div>
            <h2 class="content-section-title">Les <span class="text-primary-400 underline-memphis">R√©sultats</span></h2>
          </div>
          <div class="section-divider ml-0 mx-0 mb-8"></div>

          {hasSubsectionResultats ? (
            <div class="grid md:grid-cols-2 gap-4 sm:gap-6 md:gap-8">
              {resultats.pourMoi.length > 0 && (
                <div class="detail-box">
                  <h3 class="font-heading font-bold text-xl text-white mb-3 flex items-center gap-2">
                    <span class="text-primary-400">üë§</span> Pour moi
                  </h3>
                  <ul class="space-y-2 text-gray-400 text-sm">
                    {resultats.pourMoi.map((item) => (
                      <li class="flex items-start gap-2">
                        <svg class="w-5 h-5 text-accent-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        <span>{item}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )}

              {resultats.pourEntreprise.length > 0 && (
                <div class="detail-box">
                  <h3 class="font-heading font-bold text-xl text-white mb-3 flex items-center gap-2">
                    <span class="text-accent-400">üè¢</span> Pour l'entreprise
                  </h3>
                  <ul class="space-y-2 text-gray-400 text-sm">
                    {resultats.pourEntreprise.map((item) => (
                      <li class="flex items-start gap-2">
                        <svg class="w-5 h-5 text-primary-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        <span>{item}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )}
            </div>
          ) : (
            <div class="detail-box">
              <ul class="space-y-2 text-gray-400 text-sm">
                {resultats.unified.map((item) => (
                  <li class="flex items-start gap-2">
                    <svg class="w-5 h-5 text-accent-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <span>{item}</span>
                  </li>
                ))}
              </ul>
            </div>
          )}
        </section>
      )}

      <!-- Section 6: Les Lendemains du Projet -->
      {Object.keys(lendemains).length > 0 && (
        <section class="mb-20" id="lendemains">
          <div class="content-section-header">
            <div class="icon-box-sm">
              <span class="text-xl">üîÆ</span>
            </div>
            <h2 class="content-section-title">Les <span class="text-accent-400 underline-memphis underline-memphis-accent">Lendemains</span> du Projet</h2>
          </div>
          <div class="section-divider section-divider-accent ml-0 mx-0 mb-8"></div>
          <div class="detail-box">
            <div class="grid md:grid-cols-3 gap-4 sm:gap-6 md:gap-8">
              {lendemains['Futur imm√©diat'] && (
                <div>
                  <h3 class="font-heading font-semibold text-white mb-2 text-sm">Futur imm√©diat</h3>
                  <p class="text-gray-400 text-sm" set:html={lendemains['Futur imm√©diat'].replace(/^- /gm, '‚Ä¢ ').replace(/\n/g, '<br>')} />
                </div>
              )}
              {lendemains['√Ä moyen terme'] && (
                <div>
                  <h3 class="font-heading font-semibold text-white mb-2 text-sm">√Ä moyen terme</h3>
                  <p class="text-gray-400 text-sm" set:html={lendemains['√Ä moyen terme'].replace(/^- /gm, '‚Ä¢ ').replace(/\n/g, '<br>')} />
                </div>
              )}
              {lendemains['Aujourd\'hui'] && (
                <div>
                  <h3 class="font-heading font-semibold text-white mb-2 text-sm">Aujourd'hui</h3>
                  <p class="text-gray-400 text-sm" set:html={lendemains['Aujourd\'hui'].replace(/^- /gm, '‚Ä¢ ').replace(/\n/g, '<br>')} />
                </div>
              )}
            </div>
          </div>
        </section>
      )}

      <!-- Section 7: Mon Regard Critique -->
      {(critique.positif.length > 0 || critique.amelioration.length > 0) && (
        <section class="mb-20" id="critique">
          <div class="content-section-header">
            <div class="icon-box-sm">
              <span class="text-xl">üîç</span>
            </div>
            <h2 class="content-section-title">Mon Regard <span class="text-primary-400 underline-memphis">Critique</span></h2>
          </div>
          <div class="section-divider ml-0 mx-0 mb-8"></div>
          <div class="detail-box">
            <div class="grid md:grid-cols-2 gap-4 sm:gap-6 md:gap-8">
              {critique.positif.length > 0 && (
                <div class="p-6 bg-dark-700 border border-dark-600">
                  <h3 class="font-heading font-semibold text-white mb-2 text-sm">Ce qui a bien fonctionn√©</h3>
                  <ul class="text-gray-400 text-sm space-y-1">
                    {critique.positif.map((item) => (
                      <li>‚Ä¢ {item}</li>
                    ))}
                  </ul>
                </div>
              )}
              {critique.amelioration.length > 0 && (
                <div class="p-6 bg-dark-700 border border-dark-600">
                  <h3 class="font-heading font-semibold text-white mb-2 text-sm">Axes d'am√©lioration</h3>
                  <ul class="text-gray-400 text-sm space-y-1">
                    {critique.amelioration.map((item) => (
                      <li>‚Ä¢ {item}</li>
                    ))}
                  </ul>
                </div>
              )}
            </div>
          </div>
        </section>
      )}

      <!-- Section 8: Comp√©tences Associ√©es -->
      {relatedSkills.length > 0 && (
        <section class="mb-20" id="competences">
          <div class="content-section-header">
            <div class="icon-box-sm">
              <span class="text-xl">üîó</span>
            </div>
            <h2 class="content-section-title">Comp√©tences <span class="text-accent-400 underline-memphis underline-memphis-accent">Associ√©es</span></h2>
          </div>
          <div class="section-divider section-divider-accent ml-0 mx-0 mb-8"></div>

          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 md:gap-8">
            {relatedSkills.map((skill, index) => (
              <a
                href={`/skills/${skill.id}`}
                class={`card-glow p-6 group ${index % 3 === 1 ? 'offset-up-1' : ''} ${index % 2 === 0 ? 'wonky-box' : 'wonky-box-alt'}`}
              >
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-dark-700 border-2 border-primary-500 flex items-center justify-center">
                    <span class="text-lg">{skill.data.icon || (skill.data.category === 'technical' ? 'üíª' : 'ü§ù')}</span>
                  </div>
                  <div>
                    <h3 class="font-heading font-semibold text-white text-sm group-hover:text-primary-400 transition-colors">
                      {skill.data.title}
                    </h3>
                    <span class="text-xs text-gray-400">
                      {skill.data.category === 'technical' ? 'Technique' : 'Humaine'}
                    </span>
                  </div>
                </div>
              </a>
            ))}
          </div>
        </section>
      )}

      <!-- Navigation between projects -->
      <nav class="flex flex-col sm:flex-row justify-between items-center gap-4 pt-10 border-t border-dark-600" aria-label="Navigation entre projets">
        {prevProject ? (
          <a
            href={`/projects/${prevProject.id}`}
            class="flex items-center gap-2 text-gray-400 hover:text-primary-400 transition-colors order-2 sm:order-1"
            aria-label={`Projet pr√©c√©dent : ${prevProject.data.title}`}
          >
            <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            <span class="text-sm line-clamp-1 max-w-[120px] sm:max-w-[150px]">{prevProject.data.title}</span>
          </a>
        ) : (
          <span class="order-2 sm:order-1"></span>
        )}

        <a href="/projects" class="text-sm text-gray-400 hover:text-primary-400 transition-colors order-1 sm:order-2">
          Toutes les r√©alisations
        </a>

        {nextProject ? (
          <a
            href={`/projects/${nextProject.id}`}
            class="flex items-center gap-2 text-gray-400 hover:text-primary-400 transition-colors order-3"
            aria-label={`Projet suivant : ${nextProject.data.title}`}
          >
            <span class="text-sm line-clamp-1 max-w-[120px] sm:max-w-[150px]">{nextProject.data.title}</span>
            <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        ) : (
          <span class="order-3"></span>
        )}
      </nav>
    </div>
  </div>
</BaseLayout>
